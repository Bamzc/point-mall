define(["template","util","text!js/module/underwriting/exchangeRecord/exchangeRecord.art"],function(e,n,t){function o(e,n){$.ajax({url:"/point-mall/data/list.json",type:"get",dataType:"json",data:{pageNumber:n&&n.pageNumber||1,pageSize:n&&n.pageSize||20},success:function(n){n.success?(n.data.imgbaseurl=n.imgbaseurl,e(n.data)):alert(n.message)},fail:function(){alert("请求失败")}})}function i(){$("#exchangeRecord").find(".cy-list").on("tap","li",function(e){window.location.href=n.pathname+"#/orderDetail"})}function u(){r.initRefresh(),i()}var r={initRefresh:function(){var e=this;this.options={pageNumber:1,pageSize:7},mui("#exchangeRecord").pullRefresh({down:{height:50,auto:!0,contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新...",callback:e.pulldownRefresh},up:{height:50,auto:!1,contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:e.pullupRefresh}}),mui.os.plus?mui.plusReady(function(){setTimeout(function(){mui("#exchangeRecord").pullRefresh().pullupLoading()},1e3)}):mui.ready(function(){mui("#exchangeRecord").pullRefresh().pullupLoading()})},pulldownRefresh:function(){r.options.pageNumber=1,o(function(n){if(""==n)mui("#exchangeRecord").pullRefresh().endPulldownToRefresh();else{var o=e.render(t,n);$("#exchangeRecord").find(".cy-list").html(o),mui("#exchangeRecord").pullRefresh().endPulldownToRefresh(),mui("#exchangeRecord").pullRefresh().refresh(!0)}},r.options)},pullupRefresh:function(){r.options.pageNumber++,o(function(n){mui("#exchangeRecord").pullRefresh().endPullupToRefresh(n.lastPage==n.pageNum);var o=e.render(t,n);$("#exchangeRecord").find(".cy-list").append(o)},r.options)}};return{render:function(){var e=this;n.requestHtml("/underwriting/exchangeRecord.html",function(n){$("#pointsMall").html(n),$(document).prop("title","兑换记录"),e.loadDidView()})},loadDidView:u}});