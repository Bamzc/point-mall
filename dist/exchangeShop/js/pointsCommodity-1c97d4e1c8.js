define(["util","template","text!js/module/exchangeShop/pointsCommodity/pointsCommodity.art","common","store"],function(e,t,o,i,n){function l(e,t){$.ajax({url:"/point-mall/data/list.json",type:"get",dataType:"json",data:{pageNumber:t&&t.pageNumber||1,pageSize:t&&t.pageSize||20},success:function(t){t.success?(t.data.imgbaseurl=t.imgbaseurl,e(t.data)):alert(t.message)},error:function(){alert("请求失败")}})}function s(){$("#commodityList").find(".cy-list").on("tap","li",function(t){n.set(i.COOKIE_COMMODITY_ID,$(this).attr("data-commodityid")),window.location.href=e.pathname+"#/cydetail"})}function u(){a.initRefresh(),s()}var a={initRefresh:function(){var e=this;this.options={pageNumber:1,pageSize:7},mui("#commodityList").pullRefresh({down:{height:50,auto:!0,contentdown:"下拉可以刷新",contentover:"释放立即刷新",contentrefresh:"正在刷新...",callback:e.pulldownRefresh},up:{height:50,auto:!1,contentrefresh:"正在加载...",contentnomore:"没有更多数据了",callback:e.pullupRefresh}}),mui.os.plus?mui.plusReady(function(){setTimeout(function(){mui("#commodityList").pullRefresh().pullupLoading()},1e3)}):mui.ready(function(){mui("#commodityList").pullRefresh().pullupLoading()})},pulldownRefresh:function(){a.options.pageNumber=1,l(function(e){if(""==e)mui("#commodityList").pullRefresh().endPulldownToRefresh();else{var i=t.render(o,e);$("#commodityList").find(".cy-list").html(i),mui("#commodityList").pullRefresh().endPulldownToRefresh(),mui("#commodityList").pullRefresh().refresh(!0)}},a.options)},pullupRefresh:function(){a.options.pageNumber++,console.log(1),l(function(e){console.log(e.lastPage==e.pageNum),mui("#commodityList").pullRefresh().endPullupToRefresh(e.lastPage==e.pageNum);var i=t.render(o,e);$("#commodityList").find(".cy-list").append(i)},a.options)}};return{render:function(){var t=this;e.requestHtml("/exchangeShop/pointsCommodity.html",function(e){$(document).prop("title","积分商品"),$("#pointsMall").html(e),t.loadDidView()})},loadDidView:u}});